type: custom:apexcharts-card
graph_span: 24h
span:
  start: day
stacked: true
update_interval: 5min
header:
  show: true
  title: Centrale verwarming
  show_states: true
  colorize_states: true
yaxis:
  - id: energy
    decimals: 0
    min: 0
    max: "|+3|"
apex_config:
  chart:
    toolbar:
      show: false
  xaxis:
    tooltip:
      enabled: false
    type: datetime
    tickAmount: 12
    labels:
      formatter: |
        EVAL:(value, timestamp, opts) => {
          const h = (new Date(value)).getHours();
          if (h === 0 && value > Date.now()) {
            return '';
          }
          return h.toString();
        }
  tooltip:
    "y":
      formatter: |
        EVAL:function (value) {
          return Number(value).toFixed(2) + ' kWh';
        }       
series:
  - entity: sensor.quatt_insights
    name: Verbruikte elektriciteit
    type: column
    yaxis_id: energy
    stack_group: quatt
    color: "#cef4f7"
    float_precision: 2
    show:
      in_chart: true
      in_header: false
      legend_value: false
    data_generator: |
      const raw = entity.attributes.insights_json;
      if (!raw) return [];
      let data;
      try { data = JSON.parse(raw); } catch (e) { return []; }
      const points = data.graph || [];
      return points.map(p => {
        const ts = new Date(p.timestamp).getTime();
        const kwh = p.hpElectric / 1000;
        return [ts, kwh];
      });
  - entity: sensor.quatt_insights
    name: Warmte
    type: column
    yaxis_id: energy
    stack_group: quatt
    color: "#4faba8"
    float_precision: 2
    show:
      in_chart: true
      in_header: false
      legend_value: false
    data_generator: |
      const raw = entity.attributes.insights_json;
      if (!raw) return [];
      let data;
      try { data = JSON.parse(raw); } catch (e) { return []; }
      const points = data.graph || [];
      return points.map(p => {
        const ts = new Date(p.timestamp).getTime();
        const kwh = Math.max(0, (p.hpHeat - p.hpElectric) / 1000);
        return [ts, kwh];
      });
  - entity: sensor.quatt_insights
    name: CV-ketel
    type: column
    yaxis_id: energy
    stack_group: quatt
    color: "#ed7344"
    float_precision: 2
    show:
      in_chart: true
      in_header: false
      legend_value: false
    data_generator: |
      const raw = entity.attributes.insights_json;
      if (!raw) return [];
      let data;
      try { data = JSON.parse(raw); } catch (e) { return []; }
      const points = data.graph || [];
      return points.map(p => {
        const ts = new Date(p.timestamp).getTime();
        const kwh = p.boilerHeat / 1000;
        return [ts, kwh];
      });
  - entity: sensor.quatt_heat_today
    name: warmte door Quatt
    yaxis_id: energy
    color: "#4faba8"
    float_precision: 2
    show:
      in_chart: false
      in_header: true
      legend_value: false
  - entity: sensor.quatt_electricity_today
    name: gebruikte elektriciteit
    yaxis_id: energy
    color: "#cef4f7"
    float_precision: 2
    show:
      in_chart: false
      in_header: true
      legend_value: false
  - entity: sensor.quatt_boiler_today
    name: cv-ketel
    yaxis_id: energy
    color: "#ed7344"
    float_precision: 2
    show:
      in_chart: false
      in_header: true
      legend_value: false
  - entity: sensor.quatt_gas_today
    name: geschat gasverbruik
    yaxis_id: energy
    color: "#ed7344"
    float_precision: 2
    show:
      in_chart: false
      in_header: true
      legend_value: false
